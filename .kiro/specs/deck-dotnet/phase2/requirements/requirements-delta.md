# 需求变更跟踪文档
> [DRAFT] 本文档跟踪基于README.md修改产生的需求变更

## 文档说明
本文档跟踪基于README.md修改产生的需求变更，包括新增、修改和加强的功能点。

> 注意：本文档现在位于 `specs/deck-dotnet/phase2/requirements/requirements-delta.md`， 
> 与之前的路径 `README.md` 不同。所有引用路径已相应更新。

## 变更分类

### 🆕 新增需求

#### 1. 生产容器保护机制
**来源：** README.md 新增
**描述：** 对容器名包含 `-prod` 的容器进行特殊保护
**影响模块：** CleaningService, ContainerService
**优先级：** 高
**状态：** 待实现

**具体需求：**
- 检测容器名包含 `-prod` 的容器
- 在清理操作时提供特殊警告
- 需要额外确认步骤
- 提供停止生产容器的专门指导

**验收标准：**
- 当用户尝试清理包含 `-prod` 的容器时，系统应显示警告信息
- 用户必须明确确认才能继续操作
- 提供停止生产容器的指导信息

**测试要点：**
- 验证生产容器检测逻辑的准确性
- 验证警告信息的显示
- 验证确认流程的有效性
- 验证指导信息的准确性

#### 2. 智能项目容器过滤增强
**来源：** README.md 加强表述
**描述：** `deck ps` 更智能地过滤项目相关容器
**影响模块：** ContainerService
**优先级：** 中
**状态：** 部分实现

**具体需求：**
- 根据项目目录名过滤容器
- 显示运行中、已停止等不同状态的容器
- 提供容器运行时间等详细信息

**验收标准：**
- `deck ps` 只显示当前项目相关的容器
- 正确分类显示运行中和已停止的容器
- 显示容器的详细信息如运行时间

**测试要点：**
- 验证容器过滤逻辑的准确性
- 验证不同状态容器的正确显示
- 验证容器详细信息的准确性

### 🔄 修改需求

#### 1. 交互式选择体验优化
**来源：** README.md 详细描述
**原有设计：** 基础交互式选择
**新要求：** 
- 显示等效Podman命令提示
- 提供教育性说明
- 优化输出格式和用户引导

**影响模块：** InteractiveService, 所有Command类
**优先级：** 高
**状态：** 架构已有，实现待完善

**验收标准：**
- 所有交互式命令在执行后显示等效的Podman命令
- 提供清晰的用户引导信息
- 输出格式统一且易于理解

**测试要点：**
- 验证Podman命令提示的准确性
- 验证用户引导信息的有效性
- 验证输出格式的一致性

#### 2. 三层统一管理输出格式
**来源：** README.md 具体示例
**原有设计：** 基础三层管理
**新要求：** 特定的输出格式和分组显示

**影响模块：** ImagesUnifiedService, ConsoleDisplayService
**优先级：** 高
**状态：** 接口已定义，实现待完善

**验收标准：**
- 按照README.md中的格式显示三层资源信息
- 正确分组显示Deck配置、Podman镜像和容器信息
- 提供清晰的标识区分不同类型资源

**测试要点：**
- 验证输出格式与README.md描述的一致性
- 验证资源分组的正确性
- 验证不同类型资源标识的清晰性

### 📈 表述加强（实现优先级调整）

#### 1. 错误处理和用户引导
**来源：** README.md 大量用户友好的提示
**调整：** 错误消息、帮助信息、操作引导的友好性要求提高
**影响：** 所有用户交互点
**优先级：** 中

**验收标准：**
- 错误消息应清晰说明问题和解决方案
- 帮助信息应完整且易于理解
- 操作引导应逐步指导用户完成任务

**测试要点：**
- 验证各种错误场景下的消息提示
- 验证帮助信息的完整性和准确性
- 验证操作引导的有效性

#### 2. Podman命令教育功能
**来源：** README.md 强调教育作用
**调整：** 每次操作后显示等效命令变为重要特性
**影响：** 所有容器操作命令
**优先级：** 中

**验收标准：**
- 每次容器操作后显示等效的Podman命令
- 提供命令作用的简要说明
- 命令格式应准确无误

**测试要点：**
- 验证Podman命令的准确性
- 验证命令说明的清晰性
- 验证在各种操作后都能正确显示

## 实现状态评估

### ✅ 已实现且可用
- 基础项目结构和分层架构
- 依赖注入配置
- 基础命令框架

### ⚠️ 部分实现需完善
- InteractiveService（接口完整，实现基础）
- ContainerService（核心功能存在，细节待完善）
- ConfigurationService（基础功能可用）

### ❌ 需要重点实现
- ImagesUnifiedService（三层统一管理核心）
- CleaningService（智能清理逻辑）
- PortConflictService（端口冲突检测）
- NetworkService（网络检测完整实现）

### 🚫 已禁用待决定
- ThreeLayerWorkflowService（使用Stub，需要决定是否启用）

## 开发建议

### Phase 1: 核心功能修复（1-2周）
1. 启用并完善 ThreeLayerWorkflowService
2. 实现 ImagesUnifiedService 核心功能
3. 完善 InteractiveService 的用户体验

### Phase 2: 新增需求实现（1周）
1. 生产容器保护逻辑
2. 智能项目容器过滤
3. Podman命令教育功能

### Phase 3: 用户体验优化（1周）
1. 错误处理和用户引导优化
2. 输出格式美化
3. 帮助信息完善

## 决策点

### 需要确认的问题：
1. ThreeLayerWorkflowService 是否启用？如启用，实现优先级？
2. 生产容器保护的具体规则？
3. MVP阶段是否包含完整的三层统一管理？
4. 哪些Stub服务需要优先实现？

### 建议的决策原则：
- 优先实现用户核心使用场景
- 保证基础功能稳定后再添加高级特性
- 新增需求不应阻塞现有功能的完善